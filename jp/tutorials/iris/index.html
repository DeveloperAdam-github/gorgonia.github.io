<!doctype html><html lang=jp class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.58.3"><meta name=description content="Gorgonia's reference website"><meta name=author content="The Gorgonia Authors"><link rel=icon href=/images/favicon.png type=image/png><title>Iris データセットでの多変量線形回帰 :: Gorgonia</title><link href=/css/nucleus.css?1572680373 rel=stylesheet><link href=/css/fontawesome-all.min.css?1572680373 rel=stylesheet><link href=/css/hybrid.css?1572680373 rel=stylesheet><link href=/css/featherlight.min.css?1572680373 rel=stylesheet><link href=/css/perfect-scrollbar.min.css?1572680373 rel=stylesheet><link href=/css/auto-complete.css?1572680373 rel=stylesheet><link href=/css/atom-one-dark-reasonable.css?1572680373 rel=stylesheet><link href=/css/theme.css?1572680373 rel=stylesheet><link href=/css/hugo-theme.css?1572680373 rel=stylesheet><link href=/css/theme-gorgonia.css?1572680373 rel=stylesheet><script src=/js/jquery-3.3.1.min.js?1572680373></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style><script type=text/x-mathjax-config>
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-MML-AM_CHTML"></script><meta property=og:title content="Iris データセットでの多変量線形回帰"><meta property=og:description content="はじめに Gorgoniaを使用して線形回帰モデルを作成します。
ゴールは以下に与えられた特性を考慮して花の種別を予測することです:
 sepal_length sepal_width petal_length petal_width  存在する種別は以下の通り:
 setosa virginica versicolor  このチュートリアルのゴールはgorgoniaを使用して、与えられたirisデータセットから $\Theta$ の正しい値を見つけ以下のようなcliユーティリティを作成することです:
./iris sepal length: 5 sepal width: 3.5 petal length: 1.4 sepal length: 0.2 It is probably a setosa このチュートリアルは学術目的の為の物です。Gorgoniaでこれをどの様にして行うかを説明することがゴールです; これは特定の問題に対する最先端の答えではありません。
 数学的表現 良くある花弁の長さと幅だけでなく、がく片の長さと幅の関数であった場合とその種別について考察します。
したがって $y$ が種別の値であると考える場合に解決すべき方程式は次の通りです:
$$ y = \theta_0 &#43; \theta_1 * sepal\_length &#43; \theta_2 * sepal\_width &#43; \theta_3 * petal\_length &#43; \theta_4 * petal\_width$$
ベクトルを考慮した場合の $x$ と $\Theta$ はこうなります:"><meta property=og:type content=article><meta property=og:url content=/jp/tutorials/iris/><meta property=og:image content=https://gorgonia.org/images/opengraph.png><meta property=article:published_time content=2019-10-31T14:53:37+01:00><meta property=article:modified_time content=2019-10-31T14:53:37+01:00><meta property=og:site_name content=Gorgonia><meta name=twitter:card content=summary_large_image><meta name=twitter:image content=https://gorgonia.org/images/opengraph.png><meta name=twitter:title content="Iris データセットでの多変量線形回帰"><meta name=twitter:description content="はじめに Gorgoniaを使用して線形回帰モデルを作成します。
ゴールは以下に与えられた特性を考慮して花の種別を予測することです:
 sepal_length sepal_width petal_length petal_width  存在する種別は以下の通り:
 setosa virginica versicolor  このチュートリアルのゴールはgorgoniaを使用して、与えられたirisデータセットから $\Theta$ の正しい値を見つけ以下のようなcliユーティリティを作成することです:
./iris sepal length: 5 sepal width: 3.5 petal length: 1.4 sepal length: 0.2 It is probably a setosa このチュートリアルは学術目的の為の物です。Gorgoniaでこれをどの様にして行うかを説明することがゴールです; これは特定の問題に対する最先端の答えではありません。
 数学的表現 良くある花弁の長さと幅だけでなく、がく片の長さと幅の関数であった場合とその種別について考察します。
したがって $y$ が種別の値であると考える場合に解決すべき方程式は次の通りです:
$$ y = \theta_0 &#43; \theta_1 * sepal\_length &#43; \theta_2 * sepal\_width &#43; \theta_3 * petal\_length &#43; \theta_4 * petal\_width$$
ベクトルを考慮した場合の $x$ と $\Theta$ はこうなります:"></head><body data-url=/jp/tutorials/iris/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=/><img src=/images/logo/Logo_horizontal.png></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/js/lunr.min.js?1572680373></script><script type=text/javascript src=/js/auto-complete.js?1572680373></script><script type=text/javascript>var baseurl="\/\/jp";</script><script type=text/javascript src=/js/search.js?1572680373></script></div><div class=highlightable><ul class=topics><li data-nav-id=/jp/getting-started/ title=事始め class=dd-item><a href=/jp/getting-started/><b>X. </b>事始め
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/jp/about/ title=Gorgoniaの仕組み class=dd-item><a href=/jp/about/><b>X. </b>Gorgoniaの仕組み
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/jp/tutorials/ title=チュートリアル class="dd-item
        parent"><a href=/jp/tutorials/><b>X. </b>チュートリアル
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/jp/tutorials/hello-world/ title=こんにちわ世界 class=dd-item><a href=/jp/tutorials/hello-world/>こんにちわ世界
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/jp/tutorials/iris/ title="Iris データセットでの多変量線形回帰" class="dd-item active"><a href=/jp/tutorials/iris/>Iris データセットでの多変量線形回帰
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/jp/how-to/ title=ハウツー class=dd-item><a href=/jp/how-to/><b>X. </b>ハウツー
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/jp/how-to/dataframe/ title="データフレームからテンソルを作成 (gota)" class=dd-item><a href=/jp/how-to/dataframe/>データフレームからテンソルを作成 (gota)
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://github.com/gorgonia/gorgonia><i class="fab fa-fw fa-github"></i>GitHub</a></li><li><a class=padding href=https://godoc.org/gorgonia.org/gorgonia><i class="fas fa-fw fa-bookmark"></i>Godoc</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding><i class="fas fa-language fa-fw"></i><div class=select-style><select id=select-language onchange="location=this.value;">
<option id=en value=/tutorials/iris/>English</option>
<option id=fr value=/fr/tutorials/iris/>Français</option>
<option id=jp value=/jp/tutorials/iris/ selected>Japanese</option></select><svg id="Capa_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="255" height="255" viewBox="0 0 255 255" style="enable-background:new 0 0 255 255"><g><g id="arrow-drop-down"><path d="M0 63.75l127.5 127.5L255 63.75z" /></g></g></svg></div></a></li><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i>Clear History</a></li></ul></section><section id=footer><center><a class=github-button href=https://github.com/gorgonia/gorgonia data-icon=octicon-star data-show-count=true aria-label="Star gorgonia/gorgonia on GitHub">Star</a><p>Built with <a href=https://github.com/matcornic/hugo-theme-learn><i class="fas fa-heart"></i></a>from <a href=https://getgrav.org>Grav</a> and <a href=https://gohugo.io/>Hugo</a></p></center><script async defer src=https://buttons.github.io/buttons.js></script></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=top-github-link><a class=github-link title="Edit this page" href=https://github.com/gorgonia/gorgonia.github.io/edit/develop/content/tutorials/iris.jp.md target=blank><i class="fas fa-code-branch"></i><span id=top-github-link-text>Edit this page</span></a></div><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span id=toc-menu><i class="fas fa-list-alt"></i></span><span class=links><a href=/jp/>main</a> > <a href=/jp/tutorials/>チュートリアル</a> > Iris データセットでの多変量線形回帰</span></div><div class=progress><div class=wrapper><nav id=TableOfContents><ul><li><ul><li><a href=#はじめに>はじめに</a><ul><li><a href=#数学的表現>数学的表現</a></li><li><a href=#線形回帰>線形回帰</a></li></ul></li><li><a href=#gota-データフレーム-を使用してトレーニングセットを生成する>gota(データフレーム)を使用してトレーニングセットを生成する</a><ul><li><a href=#式グラフを作成する>式グラフを作成する</a></li></ul></li><li><a href=#勾配計算の準備>勾配計算の準備</a><ul><li><a href=#コストを保持するノードの作成>コストを保持するノードの作成</a></li><li><a href=#勾配降下法>勾配降下法</a><ul><li><a href=#the-learning-iterations>The learning iterations</a></li><li><a href=#幾らかの情報を取得>幾らかの情報を取得</a></li></ul></li><li><a href=#weightsの保存>weightsの保存</a></li></ul></li><li><a href=#推論を行う簡単なcliを作る>推論を行う簡単なcliを作る</a></li></ul></li><li><a href=#conclusion>Conclusion</a><ul><li><ul><li><a href=#ボーナス-視覚的表現>ボーナス: 視覚的表現</a></li></ul></li></ul></li></ul></nav></div></div></div></div><div id=head-tags></div><div id=body-inner><h1>Iris データセットでの多変量線形回帰</h1><h2 id=はじめに>はじめに</h2><p>Gorgoniaを使用して線形回帰モデルを作成します。</p><p>ゴールは以下に与えられた特性を考慮して花の種別を予測することです:</p><ul><li>sepal_length</li><li>sepal_width</li><li>petal_length</li><li>petal_width</li></ul><p>存在する種別は以下の通り:</p><ul><li>setosa</li><li>virginica</li><li>versicolor</li></ul><p>このチュートリアルのゴールはgorgoniaを使用して、与えられたirisデータセットから $\Theta$ の正しい値を見つけ以下のようなcliユーティリティを作成することです:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>./iris
sepal length: 5
sepal width: 3.5
petal length: 1.4
sepal length: 0.2

It is probably a setosa</code></pre></div><div class="notices warning"><p>このチュートリアルは学術目的の為の物です。Gorgoniaでこれをどの様にして行うかを説明することがゴールです;
これは特定の問題に対する最先端の答えではありません。</p></div><h3 id=数学的表現>数学的表現</h3><p>良くある花弁の長さと幅だけでなく、がく片の長さと幅の関数であった場合とその種別について考察します。</p><p>したがって $y$ が種別の値であると考える場合に解決すべき方程式は次の通りです:</p><p>$$ y = \theta_0 + \theta_1 * sepal\_length + \theta_2 * sepal\_width + \theta_3 * petal\_length + \theta_4 * petal\_width$$</p><p>ベクトルを考慮した場合の $x$ と $\Theta$ はこうなります:</p><p>$$ x = \begin{bmatrix} sepal\_length &amp; sepal\_width &amp; petal\_length &amp; petal\_width &amp; 1\end{bmatrix}$$</p><p>$$
\Theta = \begin{bmatrix}
\theta_4<br>\theta_3<br>\theta_2<br>\theta_1<br>\theta_0<br>\end{bmatrix}
$$</p><p>よってこうなります。</p><p>$$y = x\cdot\Theta$$</p><h3 id=線形回帰>線形回帰</h3><p>正しい値を見つける為に線形回帰を使用します。
データを5列(がく片の長さ、がく片の幅、花弁の長さ、花弁の幅、およびバイアスの1)を含む行列 $X$ にエンコードします。
行列の行は種別を表します。</p><p>対応する種別をfloat値を持つ列ベクトル $Y$ にエンコードします。</p><ul><li>setosa = 1.0</li><li>virginica = 2.0</li><li>versicolor = 3.0</li></ul><p>学習段階ではコストは次のように表す事ができます:</p><p>$cost = \dfrac{1}{m} \sum_{i=1}^m(X^{(i)}\cdot\Theta-Y^{(i)})^2$</p><p>勾配降下法を使用してコストを下げ $\Theta$ の正確な値を取得します</p><div class="notices info"><p>正規方程式での値として $\theta$ は取得することができます。
$$ \theta = \left( X^TX \right)^{-1}X^Ty $$
gonumでの基本的な実装についてはこの<a href=https://gist.github.com/owulveryck/19a5ba9553ff8209b3b4227b5325041b#file-normal-go>gist</a>を参照してください。</p></div><h2 id=gota-データフレーム-を使用してトレーニングセットを生成する>gota(データフレーム)を使用してトレーニングセットを生成する</h2><p>まずトレーニングデータを生成しましょう。データフレームを使用してスムーズに行います。</p><div class="notices info"><p>データフレームの使用方法やその他の情報については<a href=/how-to/dataframe/>howto</a>を参照</p></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getXYMat</span>() (<span style=color:#f92672>*</span><span style=color:#a6e22e>mat</span>.<span style=color:#a6e22e>Dense</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>mat</span>.<span style=color:#a6e22e>Dense</span>) {
        <span style=color:#a6e22e>f</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#e6db74>&#34;iris.csv&#34;</span>)
        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
                <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
        }
        <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>f</span>.<span style=color:#a6e22e>Close</span>()
        <span style=color:#a6e22e>df</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>dataframe</span>.<span style=color:#a6e22e>ReadCSV</span>(<span style=color:#a6e22e>f</span>)
        <span style=color:#a6e22e>xDF</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>df</span>.<span style=color:#a6e22e>Drop</span>(<span style=color:#e6db74>&#34;species&#34;</span>)

        <span style=color:#a6e22e>toValue</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>func</span>(<span style=color:#a6e22e>s</span> <span style=color:#a6e22e>series</span>.<span style=color:#a6e22e>Series</span>) <span style=color:#a6e22e>series</span>.<span style=color:#a6e22e>Series</span> {
                <span style=color:#a6e22e>records</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>s</span>.<span style=color:#a6e22e>Records</span>()
                <span style=color:#a6e22e>floats</span> <span style=color:#f92672>:=</span> make([]<span style=color:#66d9ef>float64</span>, len(<span style=color:#a6e22e>records</span>))
                <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>r</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>records</span> {
                        <span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>r</span> {
                        <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;setosa&#34;</span>:
                                <span style=color:#a6e22e>floats</span>[<span style=color:#a6e22e>i</span>] = <span style=color:#ae81ff>1</span>
                        <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;virginica&#34;</span>:
                                <span style=color:#a6e22e>floats</span>[<span style=color:#a6e22e>i</span>] = <span style=color:#ae81ff>2</span>
                        <span style=color:#66d9ef>case</span> <span style=color:#e6db74>&#34;versicolor&#34;</span>:
                                <span style=color:#a6e22e>floats</span>[<span style=color:#a6e22e>i</span>] = <span style=color:#ae81ff>3</span>
                        <span style=color:#66d9ef>default</span>:
                                <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatalf</span>(<span style=color:#e6db74>&#34;unknown iris: %v\n&#34;</span>, <span style=color:#a6e22e>r</span>)
                        }
                }
                <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>series</span>.<span style=color:#a6e22e>Floats</span>(<span style=color:#a6e22e>floats</span>)
        }

        <span style=color:#a6e22e>yDF</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>df</span>.<span style=color:#a6e22e>Select</span>(<span style=color:#e6db74>&#34;species&#34;</span>).<span style=color:#a6e22e>Capply</span>(<span style=color:#a6e22e>toValue</span>)
        <span style=color:#a6e22e>numRows</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>xDF</span>.<span style=color:#a6e22e>Dims</span>()
        <span style=color:#a6e22e>xDF</span> = <span style=color:#a6e22e>xDF</span>.<span style=color:#a6e22e>Mutate</span>(<span style=color:#a6e22e>series</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>one</span>(<span style=color:#a6e22e>numRows</span>), <span style=color:#a6e22e>series</span>.<span style=color:#a6e22e>Float</span>, <span style=color:#e6db74>&#34;bias&#34;</span>))
        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>xDF</span>.<span style=color:#a6e22e>Describe</span>())
        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>yDF</span>.<span style=color:#a6e22e>Describe</span>())

        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>mat</span>.<span style=color:#a6e22e>DenseCopyOf</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>matrix</span>{<span style=color:#a6e22e>xDF</span>}), <span style=color:#a6e22e>mat</span>.<span style=color:#a6e22e>DenseCopyOf</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>matrix</span>{<span style=color:#a6e22e>yDF</span>})
}</code></pre></div><p>Gorgoniaで使用できる2つの行列を返します。</p><h3 id=式グラフを作成する>式グラフを作成する</h3><p>方程式 $X\cdot\Theta$ は <a href=/reference/exprgraph>ExprGraph</a> として表されます:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getXY</span>() (<span style=color:#f92672>*</span><span style=color:#a6e22e>tensor</span>.<span style=color:#a6e22e>Dense</span>, <span style=color:#f92672>*</span><span style=color:#a6e22e>tensor</span>.<span style=color:#a6e22e>Dense</span>) {
	<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>getXYMat</span>()

	<span style=color:#a6e22e>xT</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>tensor</span>.<span style=color:#a6e22e>FromMat64</span>(<span style=color:#a6e22e>x</span>)
	<span style=color:#a6e22e>yT</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>tensor</span>.<span style=color:#a6e22e>FromMat64</span>(<span style=color:#a6e22e>y</span>)
	<span style=color:#75715e>// Get rid of the last dimension to create a vector
</span><span style=color:#75715e></span>	<span style=color:#a6e22e>s</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>yT</span>.<span style=color:#a6e22e>Shape</span>()
	<span style=color:#a6e22e>yT</span>.<span style=color:#a6e22e>Reshape</span>(<span style=color:#a6e22e>s</span>[<span style=color:#ae81ff>0</span>])
	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>xT</span>, <span style=color:#a6e22e>yT</span>
}

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
	<span style=color:#a6e22e>xT</span>, <span style=color:#a6e22e>yT</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>getXY</span>()
	<span style=color:#a6e22e>g</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>NewGraph</span>()
	<span style=color:#a6e22e>x</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>NodeFromAny</span>(<span style=color:#a6e22e>g</span>, <span style=color:#a6e22e>xT</span>, <span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>WithName</span>(<span style=color:#e6db74>&#34;x&#34;</span>))
	<span style=color:#a6e22e>y</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>NodeFromAny</span>(<span style=color:#a6e22e>g</span>, <span style=color:#a6e22e>yT</span>, <span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>WithName</span>(<span style=color:#e6db74>&#34;y&#34;</span>))
	<span style=color:#a6e22e>theta</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>NewVector</span>(
		<span style=color:#a6e22e>g</span>,
		<span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>Float64</span>,
		<span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>WithName</span>(<span style=color:#e6db74>&#34;theta&#34;</span>),
		<span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>WithShape</span>(<span style=color:#a6e22e>xT</span>.<span style=color:#a6e22e>Shape</span>()[<span style=color:#ae81ff>1</span>]),
		<span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>WithInit</span>(<span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>Uniform</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>1</span>)))

	<span style=color:#a6e22e>pred</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>must</span>(<span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>Mul</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>theta</span>))
    <span style=color:#75715e>// Saving the value for later use
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>predicted</span> <span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>Value</span>
    <span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>Read</span>(<span style=color:#a6e22e>pred</span>, <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>predicted</span>)</code></pre></div><div class="notices info"><p>Gorgoniaは高度に最適化されています。良いパフォーマンスを得る為にポインターとメモリを頻繁に使用しています。
したがって実行時(実行プロセス中)に<code>*Node</code>の<code>Value()</code>メソッドを呼び出すと誤った結果になる可能性があります。
もし実行時(例えば学習段階で)に<code>Value</code>に格納されている*Nodeの特定の値にアクセスする必要がある場合はその参照を保持する必要があります。
これが<code>Read</code>メソッドを使用している理由です。
<code>predicted</code>は $X\cdot\Theta$ の結果の値を常に格納しています。</p></div><h2 id=勾配計算の準備>勾配計算の準備</h2><p>Gorgoniaの<a href=/how-to/differentiation>象徴的な微分</a>機能を使います。</p><p>まずコスト関数を作成し <a href=/about/solver>solver</a> を使用して勾配降下を実行しコストを下げます。</p><h3 id=コストを保持するノードの作成>コストを保持するノードの作成</h3><p>コスト($cost = \dfrac{1}{m} \sum_{i=1}^m(X^{(i)}\cdot\Theta-Y^{(i)})^2$) を追加することにより <a href=/reference/exprgraph>exprgraph</a>を補完します。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>squaredError</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>must</span>(<span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>Square</span>(<span style=color:#a6e22e>must</span>(<span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>Sub</span>(<span style=color:#a6e22e>pred</span>, <span style=color:#a6e22e>y</span>))))
<span style=color:#a6e22e>cost</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>must</span>(<span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>Mean</span>(<span style=color:#a6e22e>squaredError</span>))</code></pre></div><p>このコストを下げたいので $\Theta$ に関する勾配を評価します:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>Grad</span>(<span style=color:#a6e22e>cost</span>, <span style=color:#a6e22e>theta</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatalf</span>(<span style=color:#e6db74>&#34;Failed to backpropagate: %v&#34;</span>, <span style=color:#a6e22e>err</span>)
}</code></pre></div><h3 id=勾配降下法>勾配降下法</h3><p>勾配降下のメカニズムを使用します。これは勾配を使用してパラメーター $\Theta$ を段階的に調節することを意味します。</p><p>基本的な勾配降下はGorgoniaの<a href=https://godoc.org/gorgonia.org/gorgonia#VanillaSolver>Vanilla Solver</a>によって実装されています。
学習率 $\gamma$ を0.001に設定します。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>solver</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>NewVanillaSolver</span>(<span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>WithLearnRate</span>(<span style=color:#ae81ff>0.001</span>))</code></pre></div><p>そして各ステップで勾配に感謝しつつsolverに $ \ Theta$ パラメーターを更新するように依頼します。
したがってイテレーションごとにsolverに渡す変数 <code>update</code> を設定します。</p><div class="notices info"><p>勾配降下はこの方程式に従って各ステップで <code>[]gorgonia.ValueGrad</code> に渡されるすべての値を更新します。
${\displaystyle x^{(k+1)}=x^{(k)}-\gamma \nabla f\left(x^{(k)}\right)}$
solverは<a href=/reference/node><code>Nodes</code></a>ではなく<a href=/reference/value><code>Values</code></a>で動作することを理解する事が重要です。
ただし物事を簡単にする為にValueGradは<code>*Node</code>構造によって実現される interface{} になっています。</p></div><p>この場合 $\Theta$ を最適化し次のようにsolverに値を更新する様に依頼します。</p><p>${\displaystyle \Theta^{(k+1)}=\Theta^{(k)}-\gamma \nabla f\left(\Theta^{(k)}\right)}$</p><p>そのためには $\Theta$ を<code>Solver</code>の<code>Step</code>メソッドに渡す必要があります。</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>update</span> <span style=color:#f92672>:=</span> []<span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>ValueGrad</span>{<span style=color:#a6e22e>theta</span>}
<span style=color:#75715e>// ...
</span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>solver</span>.<span style=color:#a6e22e>Step</span>(<span style=color:#a6e22e>update</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
}</code></pre></div><h4 id=the-learning-iterations>The learning iterations</h4><p>原理が分かりましたね。幾らかの勾配降下の魔法を起こし得る <a href=/reference/vm>vm</a> を使用して計算を実行する必要があります。</p><p><a href=/reference/vm>vm</a> を作成してグラフを実行します(そして勾配計算を行います):</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>machine</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>NewTapeMachine</span>(<span style=color:#a6e22e>g</span>, <span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>BindDualValues</span>(<span style=color:#a6e22e>theta</span>))
<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>machine</span>.<span style=color:#a6e22e>Close</span>()</code></pre></div><div class="notices warning"><p>solverにパラメーター $\Theta$ についての勾配を更新するように依頼します。
そのためTapeMachineに $\Theta$ の値(言わば2次元の値)を保存するよう指示しなければなりません。
これは <a href=https://godoc.org/gorgonia.org/gorgonia#BindDualValues>BindDualValues</a> 関数を使用して行います。</p></div><p>では各ステップでループを作成してグラフを実行しましょう; さぁ機械が学習します!</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>iter</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>1000000</span>
<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>err</span> <span style=color:#66d9ef>error</span>
<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; <span style=color:#a6e22e>iter</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>machine</span>.<span style=color:#a6e22e>RunAll</span>(); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;Error during iteration: %v: %v\n&#34;</span>, <span style=color:#a6e22e>i</span>, <span style=color:#a6e22e>err</span>)
                <span style=color:#66d9ef>break</span>
        }

        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>solver</span>.<span style=color:#a6e22e>Step</span>(<span style=color:#a6e22e>model</span>); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
                <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
        }
        <span style=color:#a6e22e>machine</span>.<span style=color:#a6e22e>Reset</span>() <span style=color:#75715e>// Reset is necessary in a loop like this
</span><span style=color:#75715e></span>}</code></pre></div><h4 id=幾らかの情報を取得>幾らかの情報を取得</h4><p>この呼び出しを使用して学習プロセスの情報をダンプできます</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;theta: %2.2f  Iter: %v Cost: %2.3f Accuracy: %2.2f \r&#34;</span>,
        <span style=color:#a6e22e>theta</span>.<span style=color:#a6e22e>Value</span>(),
        <span style=color:#a6e22e>i</span>,
        <span style=color:#a6e22e>cost</span>.<span style=color:#a6e22e>Value</span>(),
        <span style=color:#a6e22e>accuracy</span>(<span style=color:#a6e22e>predicted</span>.<span style=color:#a6e22e>Data</span>().([]<span style=color:#66d9ef>float64</span>), <span style=color:#a6e22e>y</span>.<span style=color:#a6e22e>Value</span>().<span style=color:#a6e22e>Data</span>().([]<span style=color:#66d9ef>float64</span>)))</code></pre></div><p><code>accuracy</code> は以下の様に定義しました:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>accuracy</span>(<span style=color:#a6e22e>prediction</span>, <span style=color:#a6e22e>y</span> []<span style=color:#66d9ef>float64</span>) <span style=color:#66d9ef>float64</span> {
        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>ok</span> <span style=color:#66d9ef>float64</span>
        <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; len(<span style=color:#a6e22e>prediction</span>); <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
                <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>math</span>.<span style=color:#a6e22e>Round</span>(<span style=color:#a6e22e>prediction</span>[<span style=color:#a6e22e>i</span>]<span style=color:#f92672>-</span><span style=color:#a6e22e>y</span>[<span style=color:#a6e22e>i</span>]) <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span> {
                        <span style=color:#a6e22e>ok</span> <span style=color:#f92672>+=</span> <span style=color:#ae81ff>1.0</span>
                }
        }
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>ok</span> <span style=color:#f92672>/</span> float64(len(<span style=color:#a6e22e>y</span>))
}</code></pre></div><p>これにより学習プロセス中には以下の様な行が表示されます:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>theta: [ 0.26  -0.41   0.44  -0.62   0.83]  Iter: 26075 Cost: 0.339 Accuracy: 0.61</code></pre></div><h3 id=weightsの保存>weightsの保存</h3><p>訓練が完了したら予測を行えるように $\Theta$ の値を保存します:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>save</span>(<span style=color:#a6e22e>value</span> <span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>Value</span>) <span style=color:#66d9ef>error</span> {
	<span style=color:#a6e22e>f</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Create</span>(<span style=color:#e6db74>&#34;theta.bin&#34;</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
	}
	<span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>f</span>.<span style=color:#a6e22e>Close</span>()
	<span style=color:#a6e22e>enc</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gob</span>.<span style=color:#a6e22e>NewEncoder</span>(<span style=color:#a6e22e>f</span>)
	<span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>enc</span>.<span style=color:#a6e22e>Encode</span>(<span style=color:#a6e22e>value</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
	}
	<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
}</code></pre></div><h2 id=推論を行う簡単なcliを作る>推論を行う簡単なcliを作る</h2><p>まずは訓練フェーズからパラメータを読み込んでみましょう：</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
        <span style=color:#a6e22e>f</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Open</span>(<span style=color:#e6db74>&#34;theta.bin&#34;</span>)
        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
                <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
        }
        <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>f</span>.<span style=color:#a6e22e>Close</span>()
        <span style=color:#a6e22e>dec</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gob</span>.<span style=color:#a6e22e>NewDecoder</span>(<span style=color:#a6e22e>f</span>)
        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>thetaT</span> <span style=color:#f92672>*</span><span style=color:#a6e22e>tensor</span>.<span style=color:#a6e22e>Dense</span>
        <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>dec</span>.<span style=color:#a6e22e>Decode</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>thetaT</span>)
        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
                <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
        }</code></pre></div><p>では前に行った様にモデル(exprgraph)を作成します:</p><div class="notices info"><p>実際のアプリケーションはおそらく別のパッケージでモデルを共有する事になるでしょう</p></div><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>g</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>NewGraph</span>()
<span style=color:#a6e22e>theta</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>NodeFromAny</span>(<span style=color:#a6e22e>g</span>, <span style=color:#a6e22e>thetaT</span>, <span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>WithName</span>(<span style=color:#e6db74>&#34;theta&#34;</span>))
<span style=color:#a6e22e>values</span> <span style=color:#f92672>:=</span> make([]<span style=color:#66d9ef>float64</span>, <span style=color:#ae81ff>5</span>)
<span style=color:#a6e22e>xT</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>tensor</span>.<span style=color:#a6e22e>New</span>(<span style=color:#a6e22e>tensor</span>.<span style=color:#a6e22e>WithBacking</span>(<span style=color:#a6e22e>values</span>))
<span style=color:#a6e22e>x</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>NodeFromAny</span>(<span style=color:#a6e22e>g</span>, <span style=color:#a6e22e>xT</span>, <span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>WithName</span>(<span style=color:#e6db74>&#34;x&#34;</span>))
<span style=color:#a6e22e>y</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>Mul</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>theta</span>)</code></pre></div><p>そして標準入力から情報を取得するforループに入り計算を実行して結果を表示します:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#a6e22e>machine</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>gorgonia</span>.<span style=color:#a6e22e>NewTapeMachine</span>(<span style=color:#a6e22e>g</span>)
<span style=color:#a6e22e>values</span>[<span style=color:#ae81ff>4</span>] = <span style=color:#ae81ff>1.0</span>
<span style=color:#66d9ef>for</span> {
        <span style=color:#a6e22e>values</span>[<span style=color:#ae81ff>0</span>] = <span style=color:#a6e22e>getInput</span>(<span style=color:#e6db74>&#34;sepal length&#34;</span>)
        <span style=color:#a6e22e>values</span>[<span style=color:#ae81ff>1</span>] = <span style=color:#a6e22e>getInput</span>(<span style=color:#e6db74>&#34;sepal widt&#34;</span>)
        <span style=color:#a6e22e>values</span>[<span style=color:#ae81ff>2</span>] = <span style=color:#a6e22e>getInput</span>(<span style=color:#e6db74>&#34;petal length&#34;</span>)
        <span style=color:#a6e22e>values</span>[<span style=color:#ae81ff>3</span>] = <span style=color:#a6e22e>getInput</span>(<span style=color:#e6db74>&#34;petal width&#34;</span>)

        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> = <span style=color:#a6e22e>machine</span>.<span style=color:#a6e22e>RunAll</span>(); <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
                <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
        }
        <span style=color:#66d9ef>switch</span> <span style=color:#a6e22e>math</span>.<span style=color:#a6e22e>Round</span>(<span style=color:#a6e22e>y</span>.<span style=color:#a6e22e>Value</span>().<span style=color:#a6e22e>Data</span>().(<span style=color:#66d9ef>float64</span>)) {
        <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>1</span>:
                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;It is probably a setosa&#34;</span>)
        <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>2</span>:
                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;It is probably a virginica&#34;</span>)
        <span style=color:#66d9ef>case</span> <span style=color:#ae81ff>3</span>:
                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;It is probably a versicolor&#34;</span>)
        <span style=color:#66d9ef>default</span>:
                <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#e6db74>&#34;unknown iris&#34;</span>)
        }
        <span style=color:#a6e22e>machine</span>.<span style=color:#a6e22e>Reset</span>()
}</code></pre></div><p>以下は入力を得る為の便利関数です:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>getInput</span>(<span style=color:#a6e22e>s</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>float64</span> {
        <span style=color:#a6e22e>reader</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bufio</span>.<span style=color:#a6e22e>NewReader</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdin</span>)
        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Printf</span>(<span style=color:#e6db74>&#34;%v: &#34;</span>, <span style=color:#a6e22e>s</span>)
        <span style=color:#a6e22e>text</span>, <span style=color:#a6e22e>_</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>reader</span>.<span style=color:#a6e22e>ReadString</span>(<span style=color:#e6db74>&#39;\n&#39;</span>)
        <span style=color:#a6e22e>text</span> = <span style=color:#a6e22e>strings</span>.<span style=color:#a6e22e>Replace</span>(<span style=color:#a6e22e>text</span>, <span style=color:#e6db74>&#34;\n&#34;</span>, <span style=color:#e6db74>&#34;&#34;</span>, <span style=color:#f92672>-</span><span style=color:#ae81ff>1</span>)

        <span style=color:#a6e22e>input</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>strconv</span>.<span style=color:#a6e22e>ParseFloat</span>(<span style=color:#a6e22e>text</span>, <span style=color:#ae81ff>64</span>)
        <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
                <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
        }
        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>input</span>
}</code></pre></div><p><code>go build</code> や <code>go run</code> を実行できます。そして <em>そう</em> !
特徴を考慮して、あやめの種別を予測できる完全に自律的なcliになりました:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-text data-lang=text>$ go run main.go
sepal length: 4.4
sepal widt: 2.9
petal length: 1.4
petal width: 0.2
It is probably a setosa
sepal length: 5.9
sepal widt: 3.0
petal length: 5.1
petal width: 1.8
It is probably a virginica</code></pre></div><h1 id=conclusion>Conclusion</h1><p>これは段階的な例です。
thetaの初期値を操作したりGorgoniaの中で物事がどの様に行われるのかを見る為にsolverを変更して試してみましょう。</p><p>全体のコードはGorgoniaプロジェクトの<a href=https://github.com/gorgonia/gorgonia/tree/master/examples>example</a>で見つける事ができます。.</p><h3 id=ボーナス-視覚的表現>ボーナス: 視覚的表現</h3><p>gonum plotter ライブラリを使えばデータセットを可視化する事ができます。
これを実現する方法の簡単な例を次に示します:</p><p><img src=/images/iris/iris.png alt=iris></p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=color:#f92672>import</span> (
    <span style=color:#e6db74>&#34;gonum.org/v1/plot&#34;</span>
    <span style=color:#e6db74>&#34;gonum.org/v1/plot/plotter&#34;</span>
    <span style=color:#e6db74>&#34;gonum.org/v1/plot/plotutil&#34;</span>
    <span style=color:#e6db74>&#34;gonum.org/v1/plot/vg&#34;</span>
    <span style=color:#e6db74>&#34;gonum.org/v1/plot/vg/draw&#34;</span>
)

<span style=color:#66d9ef>func</span> <span style=color:#a6e22e>plotData</span>(<span style=color:#a6e22e>x</span> []<span style=color:#66d9ef>float64</span>, <span style=color:#a6e22e>a</span> []<span style=color:#66d9ef>float64</span>) []<span style=color:#66d9ef>byte</span> {
	<span style=color:#a6e22e>p</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>plot</span>.<span style=color:#a6e22e>New</span>()
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
	}

	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Title</span>.<span style=color:#a6e22e>Text</span> = <span style=color:#e6db74>&#34;sepal length &amp; width&#34;</span>
	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>X</span>.<span style=color:#a6e22e>Label</span>.<span style=color:#a6e22e>Text</span> = <span style=color:#e6db74>&#34;length&#34;</span>
	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Y</span>.<span style=color:#a6e22e>Label</span>.<span style=color:#a6e22e>Text</span> = <span style=color:#e6db74>&#34;width&#34;</span>
	<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#a6e22e>plotter</span>.<span style=color:#a6e22e>NewGrid</span>())

	<span style=color:#a6e22e>l</span> <span style=color:#f92672>:=</span> len(<span style=color:#a6e22e>x</span>) <span style=color:#f92672>/</span> len(<span style=color:#a6e22e>a</span>)
	<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>k</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>1</span>; <span style=color:#a6e22e>k</span> <span style=color:#f92672>&lt;=</span> <span style=color:#ae81ff>3</span>; <span style=color:#a6e22e>k</span><span style=color:#f92672>++</span> {
		<span style=color:#a6e22e>data0</span> <span style=color:#f92672>:=</span> make(<span style=color:#a6e22e>plotter</span>.<span style=color:#a6e22e>XYs</span>, <span style=color:#ae81ff>0</span>)
		<span style=color:#66d9ef>for</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span> &lt; len(<span style=color:#a6e22e>a</span>); <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span> {
			<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>k</span> <span style=color:#f92672>!=</span> int(<span style=color:#a6e22e>a</span>[<span style=color:#a6e22e>i</span>]) {
				<span style=color:#66d9ef>continue</span>
			}
			<span style=color:#a6e22e>x1</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>x</span>[<span style=color:#a6e22e>i</span><span style=color:#f92672>*</span><span style=color:#a6e22e>l</span><span style=color:#f92672>+</span><span style=color:#ae81ff>0</span>] <span style=color:#75715e>// sepal_length
</span><span style=color:#75715e></span>			<span style=color:#a6e22e>y1</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>x</span>[<span style=color:#a6e22e>i</span><span style=color:#f92672>*</span><span style=color:#a6e22e>l</span><span style=color:#f92672>+</span><span style=color:#ae81ff>1</span>] <span style=color:#75715e>// sepal_width
</span><span style=color:#75715e></span>			<span style=color:#a6e22e>data0</span> = append(<span style=color:#a6e22e>data0</span>, <span style=color:#a6e22e>plotter</span>.<span style=color:#a6e22e>XY</span>{<span style=color:#a6e22e>X</span>: <span style=color:#a6e22e>x1</span>, <span style=color:#a6e22e>Y</span>: <span style=color:#a6e22e>y1</span>})
		}
		<span style=color:#a6e22e>data</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>plotter</span>.<span style=color:#a6e22e>NewScatter</span>(<span style=color:#a6e22e>data0</span>)
		<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
			<span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatal</span>(<span style=color:#a6e22e>err</span>)
		}
		<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>GlyphStyle</span>.<span style=color:#a6e22e>Color</span> = <span style=color:#a6e22e>plotutil</span>.<span style=color:#a6e22e>Color</span>(<span style=color:#a6e22e>k</span> <span style=color:#f92672>-</span> <span style=color:#ae81ff>1</span>)
		<span style=color:#a6e22e>data</span>.<span style=color:#a6e22e>Shape</span> = <span style=color:#f92672>&amp;</span><span style=color:#a6e22e>draw</span>.<span style=color:#a6e22e>PyramidGlyph</span>{}
		<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#a6e22e>data</span>)
		<span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>Legend</span>.<span style=color:#a6e22e>Add</span>(<span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Sprint</span>(<span style=color:#a6e22e>k</span>), <span style=color:#a6e22e>data</span>)
	}

	<span style=color:#a6e22e>w</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>p</span>.<span style=color:#a6e22e>WriterTo</span>(<span style=color:#ae81ff>4</span><span style=color:#f92672>*</span><span style=color:#a6e22e>vg</span>.<span style=color:#a6e22e>Inch</span>, <span style=color:#ae81ff>4</span><span style=color:#f92672>*</span><span style=color:#a6e22e>vg</span>.<span style=color:#a6e22e>Inch</span>, <span style=color:#e6db74>&#34;png&#34;</span>)
	<span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
		panic(<span style=color:#a6e22e>err</span>)
	}
	<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>b</span> <span style=color:#a6e22e>bytes</span>.<span style=color:#a6e22e>Buffer</span>
	<span style=color:#a6e22e>writer</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>bufio</span>.<span style=color:#a6e22e>NewWriter</span>(<span style=color:#f92672>&amp;</span><span style=color:#a6e22e>b</span>)
	<span style=color:#a6e22e>w</span>.<span style=color:#a6e22e>WriteTo</span>(<span style=color:#a6e22e>writer</span>)
	<span style=color:#a6e22e>ioutil</span>.<span style=color:#a6e22e>WriteFile</span>(<span style=color:#e6db74>&#34;out.png&#34;</span>, <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>Bytes</span>(), <span style=color:#ae81ff>0644</span>)
	<span style=color:#66d9ef>return</span> <span style=color:#a6e22e>b</span>.<span style=color:#a6e22e>Bytes</span>()
}</code></pre></div><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/jp/tutorials/hello-world/ title=こんにちわ世界><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=/jp/how-to/ title=ハウツー style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/js/clipboard.min.js?1572680373></script><script src=/js/perfect-scrollbar.min.js?1572680373></script><script src=/js/perfect-scrollbar.jquery.min.js?1572680373></script><script src=/js/jquery.sticky.js?1572680373></script><script src=/js/featherlight.min.js?1572680373></script><script src=/js/highlight.pack.js?1572680373></script><script>hljs.initHighlightingOnLoad();</script><script src=/js/modernizr.custom-3.6.0.js?1572680373></script><script src=/js/learn.js?1572680373></script><script src=/js/hugo-learn.js?1572680373></script><link href=/mermaid/mermaid.css?1572680373 rel=stylesheet><script src=/mermaid/mermaid.js?1572680373></script><script>mermaid.initialize({startOnLoad:true});</script></body></html>